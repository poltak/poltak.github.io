import{b as yt,d as er,t as te,a as ee}from"../chunks/CXnjyUtD.js";import"../chunks/CL7t4_dr.js";import{b as tr,h as gt,T as mt,a as rr,c as wt,ab as nr,aC as ar,aB as ir,O as or,Q as lr,d as ur,aq as sr,aH as Pe,aI as cr,at as z,ap as bt,ar as q,au as D,j as l,as as fr,ay as vr,q as w,aJ as R,aw as me,av as C,aL as Ne,F as hr}from"../chunks/Dyuul76F.js";import{e as ne,s as G}from"../chunks/MxA1b9NE.js";import{i as oe}from"../chunks/DN3lzGhq.js";import{e as We,i as _t}from"../chunks/C7t3uJYU.js";import{h as dr}from"../chunks/CHjvqQKf.js";import{r as pr,a as $e}from"../chunks/aHW3g2Pa.js";import{a as yr}from"../chunks/THN5qdqg.js";import{b as Re}from"../chunks/ChjwGFyX.js";import{b as gr}from"../chunks/DGhhXaDl.js";import{i as mr}from"../chunks/UvqdDaAr.js";import{o as wr}from"../chunks/D6e8Wgxi.js";import{p as Ft}from"../chunks/-fCvwRfS.js";function br(i,t,e,n,a){var r=i,o="",u;tr(()=>{if(o===(o=t()??"")){gt&&mt();return}u!==void 0&&(ur(u),u=void 0),o!==""&&(u=rr(()=>{if(gt){wt.data;for(var s=mt(),c=s;s!==null&&(s.nodeType!==8||s.data!=="");)c=s,s=nr(s);if(s===null)throw ar(),ir;yt(wt,c),r=or(s);return}var h=o+"",d=er(h);yt(lr(d),d.lastChild),r.before(d)}))})}const _r=()=>({fun:{title:"Kindle Clippings Viewer",description:'Upload a Kindle "My Clippings.txt" file and browse highlights by book or author.'}}),sn=Object.freeze(Object.defineProperty({__proto__:null,load:_r},Symbol.toStringTag,{value:"Module"}));var P=function(){return P=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},P.apply(this,arguments)};function Fr(i,t,e,n){function a(r){return r instanceof e?r:new e(function(o){o(r)})}return new(e||(e=Promise))(function(r,o){function u(h){try{c(n.next(h))}catch(d){o(d)}}function s(h){try{c(n.throw(h))}catch(d){o(d)}}function c(h){h.done?r(h.value):a(h.value).then(u,s)}c((n=n.apply(i,[])).next())})}function xr(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,a,r,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(c){return function(h){return s([c,h])}}function s(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(e=0)),e;)try{if(n=1,a&&(r=c[0]&2?a.return:c[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,c[1])).done)return r;switch(a=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,a=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){e.label=c[1];break}if(c[0]===6&&e.label<r[1]){e.label=r[1],r=c;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(c);break}r[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(i,e)}catch(h){c=[6,h],a=0}finally{n=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function A(i){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&i[t],n=0;if(e)return e.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $(i,t){var e=typeof Symbol=="function"&&i[Symbol.iterator];if(!e)return i;var n=e.call(i),a,r=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)r.push(a.value)}catch(u){o={error:u}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(o)throw o.error}}return r}var Sr="ENTRIES",zt="KEYS",Dt="VALUES",K="",Qe=function(){function i(t,e){var n=t._tree,a=Array.from(n.keys());this.set=t,this._type=e,this._path=a.length>0?[{node:n,keys:a}]:[]}return i.prototype.next=function(){var t=this.dive();return this.backtrack(),t},i.prototype.dive=function(){if(this._path.length===0)return{done:!0,value:void 0};var t=ue(this._path),e=t.node,n=t.keys;if(ue(n)===K)return{done:!1,value:this.result()};var a=e.get(ue(n));return this._path.push({node:a,keys:Array.from(a.keys())}),this.dive()},i.prototype.backtrack=function(){if(this._path.length!==0){var t=ue(this._path).keys;t.pop(),!(t.length>0)&&(this._path.pop(),this.backtrack())}},i.prototype.key=function(){return this.set._prefix+this._path.map(function(t){var e=t.keys;return ue(e)}).filter(function(t){return t!==K}).join("")},i.prototype.value=function(){return ue(this._path).node.get(K)},i.prototype.result=function(){switch(this._type){case Dt:return this.value();case zt:return this.key();default:return[this.key(),this.value()]}},i.prototype[Symbol.iterator]=function(){return this},i}(),ue=function(i){return i[i.length-1]},Ar=function(i,t,e){var n=new Map;if(t===void 0)return n;for(var a=t.length+1,r=a+e,o=new Uint8Array(r*a).fill(e+1),u=0;u<a;++u)o[u]=u;for(var s=1;s<r;++s)o[s*a]=s;return Mt(i,t,e,n,o,1,a,""),n},Mt=function(i,t,e,n,a,r,o,u){var s,c,h=r*o;try{e:for(var d=A(i.keys()),y=d.next();!y.done;y=d.next()){var m=y.value;if(m===K){var b=a[h-1];b<=e&&n.set(u,[i.get(m),b])}else{for(var g=r,p=0;p<m.length;++p,++g){for(var x=m[p],S=o*g,F=S-o,O=a[S],j=Math.max(0,g-e-1),N=Math.min(o-1,g+e),E=j;E<N;++E){var M=x!==t[E],I=a[F+E]+ +M,B=a[F+E+1]+1,U=a[S+E]+1,k=a[S+E+1]=Math.min(I,B,U);k<O&&(O=k)}if(O>e)continue e}Mt(i.get(m),t,e,n,a,g,o,u+m)}}}catch(W){s={error:W}}finally{try{y&&!y.done&&(c=d.return)&&c.call(d)}finally{if(s)throw s.error}}},Je=function(){function i(t,e){t===void 0&&(t=new Map),e===void 0&&(e=""),this._size=void 0,this._tree=t,this._prefix=e}return i.prototype.atPrefix=function(t){var e,n;if(!t.startsWith(this._prefix))throw new Error("Mismatched prefix");var a=$(be(this._tree,t.slice(this._prefix.length)),2),r=a[0],o=a[1];if(r===void 0){var u=$(et(o),2),s=u[0],c=u[1];try{for(var h=A(s.keys()),d=h.next();!d.done;d=h.next()){var y=d.value;if(y!==K&&y.startsWith(c)){var m=new Map;return m.set(y.slice(c.length),s.get(y)),new i(m,t)}}}catch(b){e={error:b}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}}return new i(r,t)},i.prototype.clear=function(){this._size=void 0,this._tree.clear()},i.prototype.delete=function(t){return this._size=void 0,Cr(this._tree,t)},i.prototype.entries=function(){return new Qe(this,Sr)},i.prototype.forEach=function(t){var e,n;try{for(var a=A(this),r=a.next();!r.done;r=a.next()){var o=$(r.value,2),u=o[0],s=o[1];t(u,s,this)}}catch(c){e={error:c}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},i.prototype.fuzzyGet=function(t,e){return Ar(this._tree,t,e)},i.prototype.get=function(t){var e=Ge(this._tree,t);return e!==void 0?e.get(K):void 0},i.prototype.has=function(t){var e=Ge(this._tree,t);return e!==void 0&&e.has(K)},i.prototype.keys=function(){return new Qe(this,zt)},i.prototype.set=function(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;var n=Ke(this._tree,t);return n.set(K,e),this},Object.defineProperty(i.prototype,"size",{get:function(){if(this._size)return this._size;this._size=0;for(var t=this.entries();!t.next().done;)this._size+=1;return this._size},enumerable:!1,configurable:!0}),i.prototype.update=function(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;var n=Ke(this._tree,t);return n.set(K,e(n.get(K))),this},i.prototype.fetch=function(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;var n=Ke(this._tree,t),a=n.get(K);return a===void 0&&n.set(K,a=e()),a},i.prototype.values=function(){return new Qe(this,Dt)},i.prototype[Symbol.iterator]=function(){return this.entries()},i.from=function(t){var e,n,a=new i;try{for(var r=A(t),o=r.next();!o.done;o=r.next()){var u=$(o.value,2),s=u[0],c=u[1];a.set(s,c)}}catch(h){e={error:h}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return a},i.fromObject=function(t){return i.from(Object.entries(t))},i}(),be=function(i,t,e){var n,a;if(e===void 0&&(e=[]),t.length===0||i==null)return[i,e];try{for(var r=A(i.keys()),o=r.next();!o.done;o=r.next()){var u=o.value;if(u!==K&&t.startsWith(u))return e.push([i,u]),be(i.get(u),t.slice(u.length),e)}}catch(s){n={error:s}}finally{try{o&&!o.done&&(a=r.return)&&a.call(r)}finally{if(n)throw n.error}}return e.push([i,t]),be(void 0,"",e)},Ge=function(i,t){var e,n;if(t.length===0||i==null)return i;try{for(var a=A(i.keys()),r=a.next();!r.done;r=a.next()){var o=r.value;if(o!==K&&t.startsWith(o))return Ge(i.get(o),t.slice(o.length))}}catch(u){e={error:u}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},Ke=function(i,t){var e,n,a=t.length;e:for(var r=0;i&&r<a;){try{for(var o=(e=void 0,A(i.keys())),u=o.next();!u.done;u=o.next()){var s=u.value;if(s!==K&&t[r]===s[0]){for(var c=Math.min(a-r,s.length),h=1;h<c&&t[r+h]===s[h];)++h;var d=i.get(s);if(h===s.length)i=d;else{var y=new Map;y.set(s.slice(h),d),i.set(t.slice(r,r+h),y),i.delete(s),i=y}r+=h;continue e}}}catch(b){e={error:b}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}var m=new Map;return i.set(t.slice(r),m),m}return i},Cr=function(i,t){var e=$(be(i,t),2),n=e[0],a=e[1];if(n!==void 0){if(n.delete(K),n.size===0)kt(a);else if(n.size===1){var r=$(n.entries().next().value,2),o=r[0],u=r[1];Ot(a,o,u)}}},kt=function(i){if(i.length!==0){var t=$(et(i),2),e=t[0],n=t[1];if(e.delete(n),e.size===0)kt(i.slice(0,-1));else if(e.size===1){var a=$(e.entries().next().value,2),r=a[0],o=a[1];r!==K&&Ot(i.slice(0,-1),r,o)}}},Ot=function(i,t,e){if(i.length!==0){var n=$(et(i),2),a=n[0],r=n[1];a.set(r+t,e),a.delete(r)}},et=function(i){return i[i.length-1]},fe,tt="or",jt="and",Er="and_not",xt=function(){function i(t){if((t==null?void 0:t.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');var e=t.autoVacuum==null||t.autoVacuum===!0?Ye:t.autoVacuum;this._options=P(P(P({},He),t),{autoVacuum:e,searchOptions:P(P({},St),t.searchOptions||{}),autoSuggestOptions:P(P({},Or),t.autoSuggestOptions||{})}),this._index=new Je,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Ze,this.addFields(this._options.fields)}return i.prototype.add=function(t){var e,n,a,r,o,u,s=this._options,c=s.extractField,h=s.tokenize,d=s.processTerm,y=s.fields,m=s.idField,b=c(t,m);if(b==null)throw new Error('MiniSearch: document does not have ID field "'.concat(m,'"'));if(this._idToShortId.has(b))throw new Error("MiniSearch: duplicate ID ".concat(b));var g=this.addDocumentId(b);this.saveStoredFields(g,t);try{for(var p=A(y),x=p.next();!x.done;x=p.next()){var S=x.value,F=c(t,S);if(F!=null){var O=h(F.toString(),S),j=this._fieldIds[S],N=new Set(O).size;this.addFieldLength(g,j,this._documentCount-1,N);try{for(var E=(a=void 0,A(O)),M=E.next();!M.done;M=E.next()){var I=M.value,B=d(I,S);if(Array.isArray(B))try{for(var U=(o=void 0,A(B)),k=U.next();!k.done;k=U.next()){var W=k.value;this.addTerm(j,g,W)}}catch(T){o={error:T}}finally{try{k&&!k.done&&(u=U.return)&&u.call(U)}finally{if(o)throw o.error}}else B&&this.addTerm(j,g,B)}}catch(T){a={error:T}}finally{try{M&&!M.done&&(r=E.return)&&r.call(E)}finally{if(a)throw a.error}}}}}catch(T){e={error:T}}finally{try{x&&!x.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}},i.prototype.addAll=function(t){var e,n;try{for(var a=A(t),r=a.next();!r.done;r=a.next()){var o=r.value;this.add(o)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},i.prototype.addAllAsync=function(t,e){var n=this;e===void 0&&(e={});var a=e.chunkSize,r=a===void 0?10:a,o={chunk:[],promise:Promise.resolve()},u=t.reduce(function(h,d,y){var m=h.chunk,b=h.promise;return m.push(d),(y+1)%r===0?{chunk:[],promise:b.then(function(){return new Promise(function(g){return setTimeout(g,0)})}).then(function(){return n.addAll(m)})}:{chunk:m,promise:b}},o),s=u.chunk,c=u.promise;return c.then(function(){return n.addAll(s)})},i.prototype.remove=function(t){var e,n,a,r,o,u,s=this._options,c=s.tokenize,h=s.processTerm,d=s.extractField,y=s.fields,m=s.idField,b=d(t,m);if(b==null)throw new Error('MiniSearch: document does not have ID field "'.concat(m,'"'));var g=this._idToShortId.get(b);if(g==null)throw new Error("MiniSearch: cannot remove document with ID ".concat(b,": it is not in the index"));try{for(var p=A(y),x=p.next();!x.done;x=p.next()){var S=x.value,F=d(t,S);if(F!=null){var O=c(F.toString(),S),j=this._fieldIds[S],N=new Set(O).size;this.removeFieldLength(g,j,this._documentCount,N);try{for(var E=(a=void 0,A(O)),M=E.next();!M.done;M=E.next()){var I=M.value,B=h(I,S);if(Array.isArray(B))try{for(var U=(o=void 0,A(B)),k=U.next();!k.done;k=U.next()){var W=k.value;this.removeTerm(j,g,W)}}catch(T){o={error:T}}finally{try{k&&!k.done&&(u=U.return)&&u.call(U)}finally{if(o)throw o.error}}else B&&this.removeTerm(j,g,B)}}catch(T){a={error:T}}finally{try{M&&!M.done&&(r=E.return)&&r.call(E)}finally{if(a)throw a.error}}}}}catch(T){e={error:T}}finally{try{x&&!x.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}this._storedFields.delete(g),this._documentIds.delete(g),this._idToShortId.delete(b),this._fieldLength.delete(g),this._documentCount-=1},i.prototype.removeAll=function(t){var e,n;if(t)try{for(var a=A(t),r=a.next();!r.done;r=a.next()){var o=r.value;this.remove(o)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Je,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}},i.prototype.discard=function(t){var e=this,n=this._idToShortId.get(t);if(n==null)throw new Error("MiniSearch: cannot discard document with ID ".concat(t,": it is not in the index"));this._idToShortId.delete(t),this._documentIds.delete(n),this._storedFields.delete(n),(this._fieldLength.get(n)||[]).forEach(function(a,r){e.removeFieldLength(n,r,e._documentCount,a)}),this._fieldLength.delete(n),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()},i.prototype.maybeAutoVacuum=function(){if(this._options.autoVacuum!==!1){var t=this._options.autoVacuum,e=t.minDirtFactor,n=t.minDirtCount,a=t.batchSize,r=t.batchWait;this.conditionalVacuum({batchSize:a,batchWait:r},{minDirtCount:n,minDirtFactor:e})}},i.prototype.discardAll=function(t){var e,n,a=this._options.autoVacuum;try{this._options.autoVacuum=!1;try{for(var r=A(t),o=r.next();!o.done;o=r.next()){var u=o.value;this.discard(u)}}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}finally{this._options.autoVacuum=a}this.maybeAutoVacuum()},i.prototype.replace=function(t){var e=this._options,n=e.idField,a=e.extractField,r=a(t,n);this.discard(r),this.add(t)},i.prototype.vacuum=function(t){return t===void 0&&(t={}),this.conditionalVacuum(t)},i.prototype.conditionalVacuum=function(t,e){var n=this;return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&e,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(function(){var a=n._enqueuedVacuumConditions;return n._enqueuedVacuumConditions=Ze,n.performVacuuming(t,a)}),this._enqueuedVacuum)):this.vacuumConditionsMet(e)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(t),this._currentVacuum)},i.prototype.performVacuuming=function(t,e){return Fr(this,void 0,void 0,function(){var n,a,r,o,u,s,c,h,d,y,m,b,g,p,x,S,F,O,j,N,E,M,I,B,U;return xr(this,function(k){switch(k.label){case 0:if(n=this._dirtCount,!this.vacuumConditionsMet(e))return[3,10];a=t.batchSize||Xe.batchSize,r=t.batchWait||Xe.batchWait,o=1,k.label=1;case 1:k.trys.push([1,7,8,9]),u=A(this._index),s=u.next(),k.label=2;case 2:if(s.done)return[3,6];c=$(s.value,2),h=c[0],d=c[1];try{for(y=(M=void 0,A(d)),m=y.next();!m.done;m=y.next()){b=$(m.value,2),g=b[0],p=b[1];try{for(x=(B=void 0,A(p)),S=x.next();!S.done;S=x.next())F=$(S.value,1),O=F[0],!this._documentIds.has(O)&&(p.size<=1?d.delete(g):p.delete(O))}catch(W){B={error:W}}finally{try{S&&!S.done&&(U=x.return)&&U.call(x)}finally{if(B)throw B.error}}}}catch(W){M={error:W}}finally{try{m&&!m.done&&(I=y.return)&&I.call(y)}finally{if(M)throw M.error}}return this._index.get(h).size===0&&this._index.delete(h),o%a!==0?[3,4]:[4,new Promise(function(W){return setTimeout(W,r)})];case 3:k.sent(),k.label=4;case 4:o+=1,k.label=5;case 5:return s=u.next(),[3,2];case 6:return[3,9];case 7:return j=k.sent(),N={error:j},[3,9];case 8:try{s&&!s.done&&(E=u.return)&&E.call(u)}finally{if(N)throw N.error}return[7];case 9:this._dirtCount-=n,k.label=10;case 10:return[4,null];case 11:return k.sent(),this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null,[2]}})})},i.prototype.vacuumConditionsMet=function(t){if(t==null)return!0;var e=t.minDirtCount,n=t.minDirtFactor;return e=e||Ye.minDirtCount,n=n||Ye.minDirtFactor,this.dirtCount>=e&&this.dirtFactor>=n},Object.defineProperty(i.prototype,"isVacuuming",{get:function(){return this._currentVacuum!=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dirtCount",{get:function(){return this._dirtCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dirtFactor",{get:function(){return this._dirtCount/(1+this._documentCount+this._dirtCount)},enumerable:!1,configurable:!0}),i.prototype.has=function(t){return this._idToShortId.has(t)},i.prototype.getStoredFields=function(t){var e=this._idToShortId.get(t);if(e!=null)return this._storedFields.get(e)},i.prototype.search=function(t,e){var n,a;e===void 0&&(e={});var r=this.executeQuery(t,e),o=[];try{for(var u=A(r),s=u.next();!s.done;s=u.next()){var c=$(s.value,2),h=c[0],d=c[1],y=d.score,m=d.terms,b=d.match,g=m.length||1,p={id:this._documentIds.get(h),score:y*g,terms:Object.keys(b),queryTerms:m,match:b};Object.assign(p,this._storedFields.get(h)),(e.filter==null||e.filter(p))&&o.push(p)}}catch(x){n={error:x}}finally{try{s&&!s.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return t===i.wildcard&&e.boostDocument==null&&this._options.searchOptions.boostDocument==null||o.sort(Ct),o},i.prototype.autoSuggest=function(t,e){var n,a,r,o;e===void 0&&(e={}),e=P(P({},this._options.autoSuggestOptions),e);var u=new Map;try{for(var s=A(this.search(t,e)),c=s.next();!c.done;c=s.next()){var h=c.value,d=h.score,y=h.terms,m=y.join(" "),b=u.get(m);b!=null?(b.score+=d,b.count+=1):u.set(m,{score:d,terms:y,count:1})}}catch(j){n={error:j}}finally{try{c&&!c.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}var g=[];try{for(var p=A(u),x=p.next();!x.done;x=p.next()){var S=$(x.value,2),b=S[0],F=S[1],d=F.score,y=F.terms,O=F.count;g.push({suggestion:b,terms:y,score:d/O})}}catch(j){r={error:j}}finally{try{x&&!x.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}return g.sort(Ct),g},Object.defineProperty(i.prototype,"documentCount",{get:function(){return this._documentCount},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"termCount",{get:function(){return this._index.size},enumerable:!1,configurable:!0}),i.loadJSON=function(t,e){if(e==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(t),e)},i.getDefault=function(t){if(He.hasOwnProperty(t))return qe(He,t);throw new Error('MiniSearch: unknown option "'.concat(t,'"'))},i.loadJS=function(t,e){var n,a,r,o,u,s,c=t.index,h=t.documentCount,d=t.nextId,y=t.documentIds,m=t.fieldIds,b=t.fieldLength,g=t.averageFieldLength,p=t.storedFields,x=t.dirtCount,S=t.serializationVersion;if(S!==1&&S!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");var F=new i(e);F._documentCount=h,F._nextId=d,F._documentIds=we(y),F._idToShortId=new Map,F._fieldIds=m,F._fieldLength=we(b),F._avgFieldLength=g,F._storedFields=we(p),F._dirtCount=x||0,F._index=new Je;try{for(var O=A(F._documentIds),j=O.next();!j.done;j=O.next()){var N=$(j.value,2),E=N[0],M=N[1];F._idToShortId.set(M,E)}}catch(Z){n={error:Z}}finally{try{j&&!j.done&&(a=O.return)&&a.call(O)}finally{if(n)throw n.error}}try{for(var I=A(c),B=I.next();!B.done;B=I.next()){var U=$(B.value,2),k=U[0],W=U[1],T=new Map;try{for(var X=(u=void 0,A(Object.keys(W))),H=X.next();!H.done;H=X.next()){var re=H.value,ae=W[re];S===1&&(ae=ae.ds),T.set(parseInt(re,10),we(ae))}}catch(Z){u={error:Z}}finally{try{H&&!H.done&&(s=X.return)&&s.call(X)}finally{if(u)throw u.error}}F._index.set(k,T)}}catch(Z){r={error:Z}}finally{try{B&&!B.done&&(o=I.return)&&o.call(I)}finally{if(r)throw r.error}}return F},i.prototype.executeQuery=function(t,e){var n=this;if(e===void 0&&(e={}),t===i.wildcard)return this.executeWildcardQuery(e);if(typeof t!="string"){var a=P(P(P({},e),t),{queries:void 0}),r=t.queries.map(function(p){return n.executeQuery(p,a)});return this.combineResults(r,a.combineWith)}var o=this._options,u=o.tokenize,s=o.processTerm,c=o.searchOptions,h=P(P({tokenize:u,processTerm:s},c),e),d=h.tokenize,y=h.processTerm,m=d(t).flatMap(function(p){return y(p)}).filter(function(p){return!!p}),b=m.map(kr(h)),g=b.map(function(p){return n.executeQuerySpec(p,h)});return this.combineResults(g,h.combineWith)},i.prototype.executeQuerySpec=function(t,e){var n,a,r,o,u=P(P({},this._options.searchOptions),e),s=(u.fields||this._options.fields).reduce(function(re,ae){var Z;return P(P({},re),(Z={},Z[ae]=qe(u.boost,ae)||1,Z))},{}),c=u.boostDocument,h=u.weights,d=u.maxFuzzy,y=u.bm25,m=P(P({},St.weights),h),b=m.fuzzy,g=m.prefix,p=this._index.get(t.term),x=this.termResults(t.term,t.term,1,p,s,c,y),S,F;if(t.prefix&&(S=this._index.atPrefix(t.term)),t.fuzzy){var O=t.fuzzy===!0?.2:t.fuzzy,j=O<1?Math.min(d,Math.round(t.term.length*O)):O;j&&(F=this._index.fuzzyGet(t.term,j))}if(S)try{for(var N=A(S),E=N.next();!E.done;E=N.next()){var M=$(E.value,2),I=M[0],B=M[1],U=I.length-t.term.length;if(U){F==null||F.delete(I);var k=g*I.length/(I.length+.3*U);this.termResults(t.term,I,k,B,s,c,y,x)}}}catch(re){n={error:re}}finally{try{E&&!E.done&&(a=N.return)&&a.call(N)}finally{if(n)throw n.error}}if(F)try{for(var W=A(F.keys()),T=W.next();!T.done;T=W.next()){var I=T.value,X=$(F.get(I),2),H=X[0],U=X[1];if(U){var k=b*I.length/(I.length+U);this.termResults(t.term,I,k,H,s,c,y,x)}}}catch(re){r={error:re}}finally{try{T&&!T.done&&(o=W.return)&&o.call(W)}finally{if(r)throw r.error}}return x},i.prototype.executeWildcardQuery=function(t){var e,n,a=new Map,r=P(P({},this._options.searchOptions),t);try{for(var o=A(this._documentIds),u=o.next();!u.done;u=o.next()){var s=$(u.value,2),c=s[0],h=s[1],d=r.boostDocument?r.boostDocument(h,"",this._storedFields.get(c)):1;a.set(c,{score:d,terms:[],match:{}})}}catch(y){e={error:y}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return a},i.prototype.combineResults=function(t,e){if(e===void 0&&(e=tt),t.length===0)return new Map;var n=e.toLowerCase();return t.reduce(zr[n])||new Map},i.prototype.toJSON=function(){var t,e,n,a,r=[];try{for(var o=A(this._index),u=o.next();!u.done;u=o.next()){var s=$(u.value,2),c=s[0],h=s[1],d={};try{for(var y=(n=void 0,A(h)),m=y.next();!m.done;m=y.next()){var b=$(m.value,2),g=b[0],p=b[1];d[g]=Object.fromEntries(p)}}catch(x){n={error:x}}finally{try{m&&!m.done&&(a=y.return)&&a.call(y)}finally{if(n)throw n.error}}r.push([c,d])}}catch(x){t={error:x}}finally{try{u&&!u.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:r,serializationVersion:2}},i.prototype.termResults=function(t,e,n,a,r,o,u,s){var c,h,d,y,m;if(s===void 0&&(s=new Map),a==null)return s;try{for(var b=A(Object.keys(r)),g=b.next();!g.done;g=b.next()){var p=g.value,x=r[p],S=this._fieldIds[p],F=a.get(S);if(F!=null){var O=F.size,j=this._avgFieldLength[S];try{for(var N=(d=void 0,A(F.keys())),E=N.next();!E.done;E=N.next()){var M=E.value;if(!this._documentIds.has(M)){this.removeTerm(S,M,e),O-=1;continue}var I=o?o(this._documentIds.get(M),e,this._storedFields.get(M)):1;if(I){var B=F.get(M),U=this._fieldLength.get(M)[S],k=Mr(B,O,this._documentCount,U,j,u),W=n*x*I*k,T=s.get(M);if(T){T.score+=W,jr(T.terms,t);var X=qe(T.match,e);X?X.push(p):T.match[e]=[p]}else s.set(M,{score:W,terms:[t],match:(m={},m[e]=[p],m)})}}}catch(H){d={error:H}}finally{try{E&&!E.done&&(y=N.return)&&y.call(N)}finally{if(d)throw d.error}}}}}catch(H){c={error:H}}finally{try{g&&!g.done&&(h=b.return)&&h.call(b)}finally{if(c)throw c.error}}return s},i.prototype.addTerm=function(t,e,n){var a=this._index.fetch(n,Et),r=a.get(t);if(r==null)r=new Map,r.set(e,1),a.set(t,r);else{var o=r.get(e);r.set(e,(o||0)+1)}},i.prototype.removeTerm=function(t,e,n){if(!this._index.has(n)){this.warnDocumentChanged(e,t,n);return}var a=this._index.fetch(n,Et),r=a.get(t);r==null||r.get(e)==null?this.warnDocumentChanged(e,t,n):r.get(e)<=1?r.size<=1?a.delete(t):r.delete(e):r.set(e,r.get(e)-1),this._index.get(n).size===0&&this._index.delete(n)},i.prototype.warnDocumentChanged=function(t,e,n){var a,r;try{for(var o=A(Object.keys(this._fieldIds)),u=o.next();!u.done;u=o.next()){var s=u.value;if(this._fieldIds[s]===e){this._options.logger("warn","MiniSearch: document with ID ".concat(this._documentIds.get(t),' has changed before removal: term "').concat(n,'" was not present in field "').concat(s,'". Removing a document after it has changed can corrupt the index!'),"version_conflict");return}}}catch(c){a={error:c}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}},i.prototype.addDocumentId=function(t){var e=this._nextId;return this._idToShortId.set(t,e),this._documentIds.set(e,t),this._documentCount+=1,this._nextId+=1,e},i.prototype.addFields=function(t){for(var e=0;e<t.length;e++)this._fieldIds[t[e]]=e},i.prototype.addFieldLength=function(t,e,n,a){var r=this._fieldLength.get(t);r==null&&this._fieldLength.set(t,r=[]),r[e]=a;var o=this._avgFieldLength[e]||0,u=o*n+a;this._avgFieldLength[e]=u/(n+1)},i.prototype.removeFieldLength=function(t,e,n,a){if(n===1){this._avgFieldLength[e]=0;return}var r=this._avgFieldLength[e]*n-a;this._avgFieldLength[e]=r/(n-1)},i.prototype.saveStoredFields=function(t,e){var n,a,r=this._options,o=r.storeFields,u=r.extractField;if(!(o==null||o.length===0)){var s=this._storedFields.get(t);s==null&&this._storedFields.set(t,s={});try{for(var c=A(o),h=c.next();!h.done;h=c.next()){var d=h.value,y=u(e,d);y!==void 0&&(s[d]=y)}}catch(m){n={error:m}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}}},i.wildcard=Symbol("*"),i}(),qe=function(i,t){return Object.prototype.hasOwnProperty.call(i,t)?i[t]:void 0},zr=(fe={},fe[tt]=function(i,t){var e,n;try{for(var a=A(t.keys()),r=a.next();!r.done;r=a.next()){var o=r.value,u=i.get(o);if(u==null)i.set(o,t.get(o));else{var s=t.get(o),c=s.score,h=s.terms,d=s.match;u.score=u.score+c,u.match=Object.assign(u.match,d),At(u.terms,h)}}}catch(y){e={error:y}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i},fe[jt]=function(i,t){var e,n,a=new Map;try{for(var r=A(t.keys()),o=r.next();!o.done;o=r.next()){var u=o.value,s=i.get(u);if(s!=null){var c=t.get(u),h=c.score,d=c.terms,y=c.match;At(s.terms,d),a.set(u,{score:s.score+h,terms:s.terms,match:Object.assign(s.match,y)})}}}catch(m){e={error:m}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return a},fe[Er]=function(i,t){var e,n;try{for(var a=A(t.keys()),r=a.next();!r.done;r=a.next()){var o=r.value;i.delete(o)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return i},fe),Dr={k:1.2,b:.7,d:.5},Mr=function(i,t,e,n,a,r){var o=r.k,u=r.b,s=r.d,c=Math.log(1+(e-t+.5)/(t+.5));return c*(s+i*(o+1)/(i+o*(1-u+u*n/a)))},kr=function(i){return function(t,e,n){var a=typeof i.fuzzy=="function"?i.fuzzy(t,e,n):i.fuzzy||!1,r=typeof i.prefix=="function"?i.prefix(t,e,n):i.prefix===!0;return{term:t,fuzzy:a,prefix:r}}},He={idField:"id",extractField:function(i,t){return i[t]},tokenize:function(i){return i.split(Lr)},processTerm:function(i){return i.toLowerCase()},fields:void 0,searchOptions:void 0,storeFields:[],logger:function(i,t){typeof(console==null?void 0:console[i])=="function"&&console[i](t)},autoVacuum:!0},St={combineWith:tt,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:Dr},Or={combineWith:jt,prefix:function(i,t,e){return t===e.length-1}},Xe={batchSize:1e3,batchWait:10},Ze={minDirtFactor:.1,minDirtCount:20},Ye=P(P({},Xe),Ze),jr=function(i,t){i.includes(t)||i.push(t)},At=function(i,t){var e,n;try{for(var a=A(t),r=a.next();!r.done;r=a.next()){var o=r.value;i.includes(o)||i.push(o)}}catch(u){e={error:u}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},Ct=function(i,t){var e=i.score,n=t.score;return n-e},Et=function(){return new Map},we=function(i){var t,e,n=new Map;try{for(var a=A(Object.keys(i)),r=a.next();!r.done;r=a.next()){var o=r.value;n.set(parseInt(o,10),i[o])}}catch(u){t={error:u}}finally{try{r&&!r.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return n},Lr=/[\n\r -#%-*,-/:;?@[-\]_{}\u00A0\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]+/u,Vr=te('<p class="file-name svelte-1os2ijs"> </p>'),Ir=te('<div class="alert svelte-1os2ijs"> </div>'),Br=te('<p class="status svelte-1os2ijs"> </p>'),Tr=te("<option> </option>"),Ur=te('<button type="button" class="clear-filter svelte-1os2ijs" aria-label="Clear book title filter">×</button>'),Pr=te("<option> </option>"),Nr=te('<button type="button" class="clear-filter svelte-1os2ijs" aria-label="Clear author filter">×</button>'),Wr=te('<span>·</span> <button type="button" class="meta-link svelte-1os2ijs"> </button>',1),$r=te("<span> </span>"),Rr=te("<span> </span>"),Qr=te("<span> </span>"),Jr=te('<article class="viewer-item svelte-1os2ijs"><p class="viewer-content svelte-1os2ijs"><!></p> <div class="viewer-meta svelte-1os2ijs"><button type="button" class="meta-link svelte-1os2ijs"> </button> <!> <!> <!> <!></div></article>'),Kr=te(`<p class="note svelte-1os2ijs">Upload your Kindle clippings and browse by book or author. Everything stays local in your
    browser.</p> <section class="card viewer-card svelte-1os2ijs"><div class="viewer-header svelte-1os2ijs"><div><h2>Upload &amp; browse</h2></div></div> <div class="upload-panel svelte-1os2ijs"><div class="upload-row svelte-1os2ijs"><label class="file-input svelte-1os2ijs" for="clippings"><input id="clippings" type="file" accept=".txt" class="svelte-1os2ijs"> <span>Choose &quot;My Clippings.txt&quot;</span></label> <span class="upload-or svelte-1os2ijs">OR</span> <button type="button" class="ghost upload-alt svelte-1os2ijs"> </button></div> <!> <p class="hint svelte-1os2ijs">Your file never leaves the browser. Everything stays local.</p></div> <!> <!> <div class="viewer-actions svelte-1os2ijs"><div class="action-card svelte-1os2ijs"><button type="button" class="ghost svelte-1os2ijs"> </button> <p class="action-help svelte-1os2ijs">Stores your parsed clippings in this browser so they load automatically next time.</p></div> <div class="action-card svelte-1os2ijs"><button type="button" class="ghost svelte-1os2ijs">Clear saved data</button> <p class="action-help svelte-1os2ijs">Removes the saved copy from this browser only. It does not change your file.</p></div></div> <div class="viewer-controls svelte-1os2ijs"><label class="field field-wide svelte-1os2ijs"><span class="svelte-1os2ijs">Search</span> <input type="search" placeholder="Search titles, authors, or highlight text" class="svelte-1os2ijs"></label> <div class="field svelte-1os2ijs"><span class="svelte-1os2ijs">Book title</span> <div class="select-wrap svelte-1os2ijs"><select class="svelte-1os2ijs"><option>All titles</option><!></select> <!></div></div> <div class="field svelte-1os2ijs"><span class="svelte-1os2ijs">Author</span> <div class="select-wrap svelte-1os2ijs"><select class="svelte-1os2ijs"><option>All authors</option><!></select> <!></div></div> <label class="field svelte-1os2ijs"><span class="svelte-1os2ijs">Type</span> <select class="svelte-1os2ijs"><option>All types</option><option>Highlight</option><option>Note</option></select></label> <label class="field svelte-1os2ijs"><span class="svelte-1os2ijs">Per page</span> <select class="svelte-1os2ijs"><option>25</option><option>50</option><option>100</option></select></label> <div class="pager svelte-1os2ijs"><button type="button" class="svelte-1os2ijs">Previous</button> <span> </span> <button type="button" class="svelte-1os2ijs">Next</button></div></div> <p class="viewer-count svelte-1os2ijs"> </p> <div class="viewer-list svelte-1os2ijs"></div></section>`,1);function cn(i,t){sr(t,!1);let e=R([]),n=R(""),a=R(""),r=R(""),o=R(null),u=R(!1),s=R(!1),c=R(0),h=R(25),d=R([]),y=R(1),m=R(""),b=R("all"),g=R("all"),p=R("all"),x=R([]),S=R([]),F=R(null),O=R(new Map),j=R([]);async function N(v){var L;const _=(L=v.currentTarget.files)==null?void 0:L[0];if(w(a,""),w(n,""),!_){w(e,[]),w(r,"");return}w(r,_.name);try{const V=await _.text(),J=Ft(V);w(e,J.normalized.filter(le=>le.type!=="Bookmark")),l(e).length===0&&w(n,'No clippings found. Check that this is a Kindle "My Clippings.txt" file.')}catch(V){w(e,[]),w(n,V instanceof Error?V.message:"Something went wrong while parsing the file.")}}async function E(){w(s,!0),w(a,""),w(n,"");try{const v=await fetch("/My%20Clippings.txt");if(!v.ok)throw new Error("Unable to load the site clippings file.");const f=await v.text(),_=Ft(f);w(e,_.normalized.filter(L=>L.type!=="Bookmark")),w(r,`Jon's "My Clippings.txt"`),l(e).length===0&&w(n,"No clippings found in the site file. Check the uploaded content.")}catch(v){w(e,[]),w(n,v instanceof Error?v.message:"Unable to load the site clippings file.")}finally{w(s,!1)}}function M(){return new Promise((v,f)=>{if(typeof indexedDB>"u"){f(new Error("IndexedDB is not available in this browser."));return}const _=indexedDB.open("kindle-clippings-viewer",1);_.onupgradeneeded=()=>{const L=_.result;L.objectStoreNames.contains("files")||L.createObjectStore("files")},_.onsuccess=()=>v(_.result),_.onerror=()=>f(_.error??new Error("Unable to open IndexedDB."))})}async function I(){var v;try{const f=await M(),V=f.transaction("files","readonly").objectStore("files").get("default"),J=await new Promise((le,Te)=>{V.onsuccess=()=>le(V.result??null),V.onerror=()=>Te(V.error??new Error("Unable to read saved data."))});(v=J==null?void 0:J.normalized)!=null&&v.length&&(w(e,J.normalized),w(r,J.sourceFileName??""),w(a,"Loaded saved clippings from this browser.")),f.close()}catch(f){w(a,f instanceof Error?f.message:"Unable to load saved clippings.")}}async function B(){if(l(e).length){w(u,!0),w(a,"");try{const v=await M(),f=v.transaction("files","readwrite");f.objectStore("files").put({normalized:l(e),sourceFileName:l(r),savedAt:new Date().toISOString()},"default"),await new Promise((L,V)=>{f.oncomplete=()=>L(),f.onerror=()=>V(f.error??new Error("Unable to save clippings.")),f.onabort=()=>V(f.error??new Error("Unable to save clippings."))}),w(a,"Saved clippings to this browser."),v.close()}catch(v){w(a,v instanceof Error?v.message:"Unable to save clippings.")}finally{w(u,!1)}}}async function U(){if(!(typeof window<"u"&&!window.confirm("Clear saved clippings from this browser and reset the current view? This cannot be undone."))){w(e,[]),w(r,""),w(c,0),w(a,"");try{const v=await M(),f=v.transaction("files","readwrite");f.objectStore("files").delete("default"),await new Promise((L,V)=>{f.oncomplete=()=>L(),f.onerror=()=>V(f.error??new Error("Unable to clear saved clippings.")),f.onabort=()=>V(f.error??new Error("Unable to clear saved clippings."))}),w(a,"Cleared saved clippings from this browser."),v.close()}catch(v){w(a,v instanceof Error?v.message:"Unable to clear saved clippings.")}}}function k(v){return v.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function W(v){return v.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function T(v){if(!v)return"—";const f=k(v);if(!l(j).length)return f;const _=new RegExp(`(${l(j).map(W).join("|")})`,"gi");return f.replace(_,"<mark>$1</mark>")}wr(()=>{I(),typeof window<"u"&&new URLSearchParams(window.location.search).get("source")==="site"&&E()}),Pe(()=>(l(e),l(g),l(p)),()=>{var _,L;l(e);const v=new Set,f=new Set;for(const V of l(e))v.add(((_=V.title)==null?void 0:_.trim())||"Untitled"),f.add(((L=V.author)==null?void 0:L.trim())||"Unknown Author");w(x,Array.from(v).sort((V,J)=>V.localeCompare(J))),w(S,Array.from(f).sort((V,J)=>V.localeCompare(J))),l(g)!=="all"&&!v.has(l(g))&&w(g,"all"),l(p)!=="all"&&!f.has(l(p))&&w(p,"all"),l(g)!=="all"&&l(p)!=="all"&&w(p,"all"),w(c,0)}),Pe(()=>(l(e),l(O),l(F),xt),()=>{if(l(e),w(O,new Map),l(e).length===0)w(F,null);else{const v=l(e).map((f,_)=>{var V,J;const L=String(f.sourceIndex??_);return l(O).set(L,f),{id:L,title:f.title??"",author:f.author??"",content:f.content??"",type:f.type??"",groupTitle:((V=f.title)==null?void 0:V.trim())||"Untitled",groupAuthor:((J=f.author)==null?void 0:J.trim())||"Unknown Author"}});w(F,new xt({fields:["title","author","content"],storeFields:["id","title","author","type","groupTitle","groupAuthor"],searchOptions:{boost:{title:2,author:1.5},prefix:!0,fuzzy:.2}})),l(F).addAll(v)}}),Pe(()=>(l(m),l(b),l(g),l(p),l(F),l(d),l(O),l(e),l(y),l(h),l(c)),()=>{l(m),l(b),l(g),l(p),l(F);const v=l(m).trim();if(w(j,v?v.split(/\s+/).map(f=>f.trim()).filter(f=>f.length>1):[]),v&&l(F)){const f=l(F).search(v,{filter:_=>!(l(b)!=="all"&&_.type!==l(b)||l(g)!=="all"&&_.groupTitle!==l(g)||l(p)!=="all"&&_.groupAuthor!==l(p))});w(d,f.map(_=>l(O).get(String(_.id))).filter(_=>!!_))}else w(d,l(e).filter(f=>{var _,L;return!(l(b)!=="all"&&f.type!==l(b)||l(g)!=="all"&&(((_=f.title)==null?void 0:_.trim())||"Untitled")!==l(g)||l(p)!=="all"&&(((L=f.author)==null?void 0:L.trim())||"Unknown Author")!==l(p))}));w(y,Math.max(1,Math.ceil(l(d).length/l(h)))),w(c,Math.min(l(c),l(y)-1))}),cr(),mr();var X=Kr();dr(v=>{vr.title="Kindle Clippings Viewer"});var H=z(bt(X),2),re=z(D(H),2),ae=D(re),Z=D(ae),rt=D(Z);gr(rt,v=>w(o,v),()=>l(o)),me(2),C(Z);var ve=z(Z,4),Lt=D(ve,!0);C(ve),C(ae);var Vt=z(ae,2);{var It=v=>{var f=Vr(),_=D(f);C(f),q(()=>G(_,`Selected: ${l(r)??""}`)),ee(v,f)};oe(Vt,v=>{l(r)&&v(It)})}me(2),C(re);var nt=z(re,2);{var Bt=v=>{var f=Ir(),_=D(f,!0);C(f),q(()=>G(_,l(n))),ee(v,f)};oe(nt,v=>{l(n)&&v(Bt)})}var at=z(nt,2);{var Tt=v=>{var f=Br(),_=D(f,!0);C(f),q(()=>G(_,l(a))),ee(v,f)};oe(at,v=>{l(a)&&v(Tt)})}var _e=z(at,2),Fe=D(_e),he=D(Fe),Ut=D(he,!0);C(he),me(2),C(Fe);var it=z(Fe,2),Pt=D(it);me(2),C(it),C(_e);var xe=z(_e,2),Se=D(xe),Ae=z(D(Se),2);pr(Ae),C(Se);var Ce=z(Se,2),ot=z(D(Ce),2),se=D(ot);q(()=>{l(g),Ne(()=>{l(e),l(x)})});var Ee=D(se);Ee.value=(Ee.__value="all")==null?"":"all";var Nt=z(Ee);We(Nt,1,()=>l(x),_t,(v,f)=>{var _=Tr(),L={},V=D(_,!0);C(_),q(()=>{L!==(L=l(f))&&(_.value=(_.__value=l(f))==null?"":l(f)),G(V,l(f))}),ee(v,_)}),C(se);var Wt=z(se,2);{var $t=v=>{var f=Ur();ne("click",f,()=>w(g,"all")),ee(v,f)};oe(Wt,v=>{l(g)!=="all"&&v($t)})}C(ot),C(Ce);var ze=z(Ce,2),lt=z(D(ze),2),ce=D(lt);q(()=>{l(p),Ne(()=>{l(e),l(g),l(S)})});var De=D(ce);De.value=(De.__value="all")==null?"":"all";var Rt=z(De);We(Rt,1,()=>l(S),_t,(v,f)=>{var _=Pr(),L={},V=D(_,!0);C(_),q(()=>{L!==(L=l(f))&&(_.value=(_.__value=l(f))==null?"":l(f)),G(V,l(f))}),ee(v,_)}),C(ce);var Qt=z(ce,2);{var Jt=v=>{var f=Nr();q(()=>f.disabled=l(g)!=="all"),ne("click",f,()=>w(p,"all")),ee(v,f)};oe(Qt,v=>{l(p)!=="all"&&v(Jt)})}C(lt),C(ze);var Me=z(ze,2),de=z(D(Me),2);q(()=>{l(b),Ne(()=>{l(e)})});var ke=D(de);ke.value=(ke.__value="all")==null?"":"all";var Oe=z(ke);Oe.value=(Oe.__value="Highlight")==null?"":"Highlight";var ut=z(Oe);ut.value=(ut.__value="Note")==null?"":"Note",C(de),C(Me);var je=z(Me,2),pe=z(D(je),2),ye=D(pe);ye.value=(ye.__value="25")==null?"":"25";var ge=z(ye);ge.value=(ge.__value="50")==null?"":"50";var Le=z(ge);Le.value=(Le.__value="100")==null?"":"100",C(pe),C(je);var st=z(je,2),Ve=D(st),Ie=z(Ve,2),Kt=D(Ie);C(Ie);var ct=z(Ie,2);C(st),C(xe);var Be=z(xe,2),qt=D(Be);C(Be);var ft=z(Be,2);We(ft,5,()=>l(d).slice(l(c)*l(h),(l(c)+1)*l(h)),v=>v.sourceIndex,(v,f)=>{var _=Jr(),L=D(_),V=D(L);br(V,()=>T(l(f).content)),C(L);var J=z(L,2),le=D(J),Te=D(le,!0);C(le);var vt=z(le,2);{var Ht=Q=>{var Y=Wr(),ie=z(bt(Y),2),Ue=D(ie,!0);C(ie),q(()=>G(Ue,l(f).author)),ne("click",ie,()=>{var pt;w(p,((pt=l(f).author)==null?void 0:pt.trim())||"Unknown Author"),w(g,"all")}),ee(Q,Y)};oe(vt,Q=>{l(f).author&&Q(Ht)})}var ht=z(vt,2);{var Yt=Q=>{var Y=$r(),ie=D(Y);C(Y),q(()=>G(ie,`· ${l(f).type??""}`)),ee(Q,Y)};oe(ht,Q=>{l(f).type&&Q(Yt)})}var dt=z(ht,2);{var Gt=Q=>{var Y=Rr(),ie=D(Y);C(Y),q(Ue=>G(ie,`· ${Ue??""}`),[()=>new Date(l(f).addedOn).toLocaleDateString()],hr),ee(Q,Y)};oe(dt,Q=>{l(f).addedOn&&Q(Gt)})}var Xt=z(dt,2);{var Zt=Q=>{var Y=Qr(),ie=D(Y);C(Y),q(()=>G(ie,`· Loc ${l(f).locationStart??""}`)),ee(Q,Y)};oe(Xt,Q=>{l(f).locationStart&&Q(Zt)})}C(J),C(_),q(()=>G(Te,l(f).title)),ne("click",le,()=>{var Q;w(g,((Q=l(f).title)==null?void 0:Q.trim())||"Untitled"),w(p,"all")}),ee(v,_)}),C(ft),C(H),q(()=>{ve.disabled=l(s),G(Lt,l(s)?"Loading...":"Browse my own personal highlights"),he.disabled=!l(e).length||l(u),G(Ut,l(u)?"Saving...":"Save"),Ae.disabled=!l(e).length,se.disabled=!l(e).length,ce.disabled=!l(e).length||l(g)!=="all",de.disabled=!l(e).length,pe.disabled=!l(e).length,$e(ye,l(h)===25),$e(ge,l(h)===50),$e(Le,l(h)===100),Ve.disabled=!l(e).length||l(c)===0,G(Kt,`Page ${l(c)+1} of ${l(y)??""}`),ct.disabled=!l(e).length||l(c)>=l(y)-1,G(qt,`${l(d).length??""} items`)}),ne("change",rt,N),ne("click",ve,E),ne("click",he,B),ne("click",Pt,U),yr(Ae,()=>l(m),v=>w(m,v)),Re(se,()=>l(g),v=>w(g,v)),Re(ce,()=>l(p),v=>w(p,v)),Re(de,()=>l(b),v=>w(b,v)),ne("change",pe,v=>w(h,Number(v.currentTarget.value))),ne("click",Ve,()=>w(c,Math.max(0,l(c)-1))),ne("click",ct,()=>w(c,Math.min(l(y)-1,l(c)+1))),ee(i,X),fr()}export{cn as component,sn as universal};
