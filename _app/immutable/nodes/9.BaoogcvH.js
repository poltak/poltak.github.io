import{t as E,a as C}from"../chunks/CByQ9JHw.js";import"../chunks/DNLDhpPS.js";import{ap as yt,aG as et,aH as _t,as as u,ao as bt,aq as S,j as e,ar as wt,ax as xt,at as p,D as qt,aI as g,o as l,av as D,au as d,aJ as Rt}from"../chunks/CCTiSMZp.js";import{e as w,s as x}from"../chunks/NeNTXivj.js";import{i as I}from"../chunks/BQyXyV8_.js";import{h as Ct}from"../chunks/DTHiTXA2.js";import{s as nt,r as St}from"../chunks/D0AAtD2c.js";import{t as O}from"../chunks/Mb5qikYY.js";import{r as Ot}from"../chunks/BbNDu2kw.js";import{b as Et,a as $t}from"../chunks/CXgyCfud.js";import{b as Nt}from"../chunks/DsMOWITn.js";import{i as kt}from"../chunks/DJ1r3Yl9.js";const jt=()=>({fun:{title:"Kindle Clippings Converter",description:'Upload your Kindle "My Clippings.txt" file and export your highlights as CSV or JSON, ready for spreadsheets, Notion, or further processing.'}}),me=Object.freeze(Object.defineProperty({__proto__:null,load:jt},Symbol.toStringTag,{value:"Module"})),Mt="==========",At=/^(.+?)(?:\s*\((.+)\))?\s*$/,Tt=/^-\s+Your\s+(.+?)\s+at\s+(.+)$/,Lt=/location\s+(\d+(?:-\d+)?)/i,Ut=/page\s+(\d+(?:-\d+)?)/i,Jt=/Added on\s+(.+)$/i,Ft={January:"01",February:"02",March:"03",April:"04",May:"05",June:"06",July:"07",August:"08",September:"09",October:"10",November:"11",December:"12"};function zt(a){return a.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(`
`)}function Dt(a){const t=a,n=a.replace(/^\ufeff/,"").trim(),s=n.match(At);if(!s)return{text:n,raw:t};const r=s[1].trim(),o=s[2]?s[2].trim():void 0;return{text:r,author:o,raw:t}}function It(a){const t=a.trim(),n=[],s=t.match(Tt);if(!s)return{type:t,raw:t,issues:["metadata-unmatched"]};const r=s[1].trim(),o=s[2],i=o.match(Lt),f=o.match(Ut),v=o.match(Jt);return!i&&!f&&n.push("missing-location-or-page"),{type:r,raw:t,rest:o,locationRaw:i?i[1]:void 0,pageRaw:f?f[1]:void 0,addedOnRaw:v?v[1].trim():void 0,issues:n}}function at(a){if(!a)return{};if(a.includes("-")){const[n,s]=a.split("-",2),r=Number(n),o=Number(s);return{start:Number.isFinite(r)?r:void 0,end:Number.isFinite(o)?o:void 0}}const t=Number(a);return Number.isFinite(t)?{start:t,end:t}:{}}function Bt(a){if(!a)return;const t=a.match(/^[A-Za-z]+,\s+(\d{1,2})\s+([A-Za-z]+)\s+(\d{4})\s+(\d{2}):(\d{2}):(\d{2})$/);if(!t)return;const n=t[1].padStart(2,"0"),s=t[2],r=t[3],o=t[4],i=t[5],f=t[6],v=Ft[s];if(v)return`${r}-${v}-${n} ${o}:${i}:${f}`}function Kt(a){let t=0,n=a.lines.length;for(;t<n&&a.lines[t].trim()==="";)t+=1;for(;n>t&&a.lines[n-1].trim()==="";)n-=1;const s=a.lines.slice(t,n);if(s.length<2)return;const r=s[0],o=s[1];let i=s.slice(2);i.length>0&&i[0].trim()===""&&(i=i.slice(1));const f=Dt(r),v=It(o),y=i.join(`
`).trim(),h=y.length>0?y:void 0,b=[...v.issues];return!h&&v.type.toLowerCase().includes("highlight")&&b.push("highlight-missing-content"),{title:f,meta:v,content:h,raw:{titleLine:r,metaLine:o,contentLines:i},issues:b,sourceIndex:a.index}}function Pt(a){const t=a.replace(/^\ufeff/,""),n=zt(t),s=[];let r=[],o=0;for(const i of n){if(i.trim()===Mt){r.length>0&&(s.push({index:o,lines:r,rawText:r.join(`
`)}),o+=1),r=[];continue}r.push(i)}return r.length>0&&s.push({index:o,lines:r,rawText:r.join(`
`)}),s}function Ht(a){const t=[];for(const n of a){const s=Kt(n);s&&t.push(s)}return t}function Gt(a){return a.map(t=>{const{start:n,end:s}=at(t.meta.locationRaw),{start:r,end:o}=at(t.meta.pageRaw),i=Bt(t.meta.addedOnRaw);return{title:t.title.text,author:t.title.author,type:t.meta.type,locationStart:n,locationEnd:s,pageStart:r,pageEnd:o,addedOn:i,content:t.content,rawMetadata:t.meta.raw,sourceIndex:t.sourceIndex}})}function Vt(a){const t=Pt(a),n=Ht(t),s=Gt(n);return{rawBlocks:t,parsed:n,normalized:s}}const Yt=["title","author","type","location_start","location_end","page_start","page_end","added_on","content","raw_metadata"];function Zt(a){return/[",\n\r]/.test(a)?`"${a.replace(/"/g,'""')}"`:a}function Qt(a){var n,s,r,o;const t=[Yt.join(",")];for(const i of a){const f=[i.title,i.author??"",i.type,((n=i.locationStart)==null?void 0:n.toString())??"",((s=i.locationEnd)==null?void 0:s.toString())??"",((r=i.pageStart)==null?void 0:r.toString())??"",((o=i.pageEnd)==null?void 0:o.toString())??"",i.addedOn??"",i.content??"",i.rawMetadata].map(Zt);t.push(f.join(","))}return`${t.join(`
`)}
`}function Wt(a,t={}){const{pretty:n=!0}=t;return JSON.stringify(a,null,n?2:0)+`
`}var Xt=E('<p class="file-name svelte-q14ylc"> </p>'),te=E('<div class="alert svelte-q14ylc"> </div>'),ee=E('<p class="status svelte-q14ylc"> </p>'),ne=E(`<p class="note svelte-q14ylc">Built on my <a href="https://www.npmjs.com/package/kindle-highlights-parser" target="_blank" rel="noopener noreferrer" class="svelte-q14ylc">kindle-highlights-parser</a> package.</p> <section class="card svelte-q14ylc"><h2>1. Upload your file</h2> <div class="upload-panel svelte-q14ylc"><label class="file-input svelte-q14ylc" for="clippings"><input id="clippings" type="file" accept=".txt" class="svelte-q14ylc"> <span>Choose &quot;My Clippings.txt&quot;</span></label> <!> <p class="hint svelte-q14ylc">Your file never leaves the browser. Everything stays local.</p></div> <!></section> <section class="card svelte-q14ylc"><h2>2. Choose output</h2> <div class="controls svelte-q14ylc"><div class="toggle-group svelte-q14ylc" role="group" aria-label="Output format"><button type="button" class="svelte-q14ylc">CSV</button> <button type="button" class="svelte-q14ylc">JSON</button></div> <label class="checkbox svelte-q14ylc"><input type="checkbox"> Pretty JSON</label> <button type="button" class="ghost svelte-q14ylc">Reset</button></div> <div class="summary svelte-q14ylc"><div><span class="label svelte-q14ylc">Clippings parsed</span> <span class="value svelte-q14ylc"> </span></div> <div><span class="label svelte-q14ylc">Output format</span> <span class="value svelte-q14ylc"> </span></div></div></section> <section class="card output-card svelte-q14ylc"><div class="output-header svelte-q14ylc"><h2>3. Export</h2> <div class="actions svelte-q14ylc"><button type="button" class="svelte-q14ylc">Copy</button> <a rel="noopener noreferrer" class="svelte-q14ylc">Download</a></div></div> <!> <textarea class="output svelte-q14ylc" readonly="" placeholder="Upload a file to see the output here.">
    </textarea></section>`,1);function he(a,t){yt(t,!1);let n=g("csv"),s=g(!0),r=g([]),o=g(""),i=g(""),f=g(null),v=g(""),y=g(""),h=g(""),b=g(null);function st(){return`${e(h)?e(h).replace(/\.txt$/i,"").replace(/\s+/g,"-").toLowerCase():"kindle-clippings"}.${e(n)}`}async function rt(c){var tt;const _=(tt=c.currentTarget.files)==null?void 0:tt[0];if(l(y,""),l(v,""),!_){l(r,[]),l(h,"");return}l(h,_.name);try{const R=await _.text(),gt=Vt(R);l(r,gt.normalized),e(r).length===0&&l(v,'No clippings found. Check that this is a Kindle "My Clippings.txt" file.')}catch(R){l(r,[]),l(v,R instanceof Error?R.message:"Something went wrong while parsing the file.")}}function ot(){if(e(r).length===0){l(o,""),l(i,"");return}l(o,e(n)==="csv"?Qt(e(r)):Wt(e(r),{pretty:e(s)})),l(i,st())}async function it(){if(e(o))try{await navigator.clipboard.writeText(e(o)),l(y,"Copied to clipboard.")}catch(c){l(y,c instanceof Error?c.message:"Unable to copy output to clipboard.")}}function lt(){l(r,[]),l(o,""),l(i,""),l(v,""),l(y,""),l(h,""),e(b)&&Rt(b,e(b).value="")}et(()=>(e(r),e(n),e(s)),()=>{e(r),e(n),e(s),ot()}),et(()=>(e(f),e(o),e(n)),()=>{typeof window<"u"&&(e(f)&&URL.revokeObjectURL(e(f)),l(f,e(o)?URL.createObjectURL(new Blob([e(o)],{type:e(n)==="csv"?"text/csv;charset=utf-8":"application/json;charset=utf-8"})):null))}),_t(),kt();var B=ne();Ct(c=>{xt.title="Kindle Clippings Converter"});var $=u(bt(B),2),N=u(p($),2),k=p(N),K=p(k);Nt(K,c=>l(b,c),()=>e(b)),D(2),d(k);var ct=u(k,2);{var ut=c=>{var m=Xt(),_=p(m);d(m),S(()=>x(_,`Selected: ${e(h)??""}`)),C(c,m)};I(ct,c=>{e(h)&&c(ut)})}D(2),d(N);var pt=u(N,2);{var dt=c=>{var m=te(),_=p(m,!0);d(m),S(()=>x(_,e(v))),C(c,m)};I(pt,c=>{e(v)&&c(dt)})}d($);var j=u($,2),M=u(p(j),2),A=p(M),T=p(A),P=u(T,2);d(A);var q=u(A,2),L=p(q);St(L),D(),d(q);var ft=u(q,2);d(M);var H=u(M,2),U=p(H),G=u(p(U),2),vt=p(G,!0);d(G),d(U);var V=u(U,2),Y=u(p(V),2),mt=p(Y,!0);d(Y),d(V),d(H),d(j);var Z=u(j,2),J=p(Z),Q=u(p(J),2),F=p(Q),z=u(F,2);d(Q),d(J);var W=u(J,2);{var ht=c=>{var m=ee(),_=p(m,!0);d(m),S(()=>x(_,e(y))),C(c,m)};I(W,c=>{e(y)&&c(ht)})}var X=u(W,2);Ot(X),d(Z),S(c=>{O(T,"active",e(n)==="csv"),O(P,"active",e(n)==="json"),O(q,"disabled",e(n)!=="json"),L.disabled=e(n)!=="json",x(vt,e(r).length),x(mt,c),F.disabled=!e(o),nt(z,"href",e(f)??"#"),nt(z,"download",e(i)),O(z,"disabled",!e(f))},[()=>e(n).toUpperCase()],qt),w("change",K,rt),w("click",T,()=>l(n,"csv")),w("click",P,()=>l(n,"json")),Et(L,()=>e(s),c=>l(s,c)),w("click",ft,lt),w("click",F,it),$t(X,()=>e(o),c=>l(o,c)),C(a,B),wt()}export{he as component,me as universal};
